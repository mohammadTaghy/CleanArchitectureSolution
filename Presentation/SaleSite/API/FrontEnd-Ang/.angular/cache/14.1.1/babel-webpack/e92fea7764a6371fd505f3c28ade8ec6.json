{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { ofType, Effect, createEffect } from \"@ngrx/effects\";\nimport { switchMap, catchError, map } from 'rxjs/operators';\nimport { of } from \"rxjs\";\nimport * as LoginActions from \"./login.action\";\nimport { ApiUrlPostfix } from \"../../../commonComponent/apiAddresses/apiAddresses.common\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngrx/effects\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../../../commonComponent/callAPI/callAPI.common\";\nimport * as i4 from \"../../../commonComponent/apiAddresses/apiAddresses.common\";\n\nclass LoginRequestClass {\n  constructor(UserName, Password) {\n    this.UserName = UserName;\n    this.Password = Password;\n  }\n\n}\n\nexport class LoginEffects {\n  //@Effect({ dispatch: false })\n  //authRedirect = this.actions$.pipe(\n  //  ofType(LoginActions.Login_SUCCESS),\n  //  tap(() => {\n  //    this.router.navigate(['/AdminPanel']);\n  //  })\n  //);\n  //@Effect()\n  //autoLogin = this.actions$.pipe(\n  //  ofType(LoginActions.AUTO_LOGIN),\n  //  map(() => {\n  //    const user: User = JSON.parse(localStorage.getItem('userData'));\n  //    if (!user) {\n  //      return { type: 'عدم دسترسی' };\n  //    }\n  //    return new LoginActions.LoginSuccess(user);\n  //  })\n  //);\n  //@Effect()\n  //logout = this.actions$.pipe(\n  //  ofType(LoginActions.LOGOUT),\n  //  tap(() => {\n  //    new LoginActions.Logout();\n  //    localStorage.removeItem('userData')\n  //    this.router.navigate([''])\n  //  })\n  //)\n  constructor(sources, actions$, router, callAPIComponent, apiAddresses) {\n    this.sources = sources;\n    this.actions$ = actions$;\n    this.router = router;\n    this.callAPIComponent = callAPIComponent;\n    this.apiAddresses = apiAddresses;\n    this.login = createEffect(() => this.actions$.pipe(ofType(LoginActions.LOGIN_START), switchMap(data => {\n      console.log('effect');\n      console.log(data);\n      return this.callAPIComponent.PostApi(this.apiAddresses.GetServiceUrl(ApiUrlPostfix.CmsLogin), new LoginRequestClass(data.payload.userName, data.payload.password)).pipe(map(resData => {\n        localStorage.setItem('userData', JSON.stringify(resData));\n        return new LoginActions.LoginSuccess(resData);\n      }), catchError(errorRes => {\n        return of(new LoginActions.LoginFail(errorRes.error));\n      }));\n    })));\n    sources.addEffects(this);\n    console.log('effect inject');\n  }\n\n}\n\nLoginEffects.ɵfac = function LoginEffects_Factory(t) {\n  return new (t || LoginEffects)(i0.ɵɵinject(i1.EffectSources), i0.ɵɵinject(i1.Actions), i0.ɵɵinject(i2.Router), i0.ɵɵinject(i3.CallAPIComponent), i0.ɵɵinject(i4.ApiAddresses));\n};\n\nLoginEffects.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: LoginEffects,\n  factory: LoginEffects.ɵfac\n});\n\n__decorate([Effect()], LoginEffects.prototype, \"login\", void 0);","map":null,"metadata":{},"sourceType":"module"}