{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { ofType, Effect } from \"@ngrx/effects\";\nimport { switchMap, catchError, map, tap } from 'rxjs/operators';\nimport { of } from \"rxjs\";\nimport * as LoginActions from \"./login.action\";\nimport { ApiUrlPostfix } from \"../../../commonComponent/apiAddresses/apiAddresses.common\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngrx/effects\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../../../commonComponent/callAPI/callAPI.common\";\nimport * as i4 from \"../../../commonComponent/apiAddresses/apiAddresses.common\";\n\nclass LoginRequestClass {\n  constructor(UserName, Password) {\n    this.UserName = UserName;\n    this.Password = Password;\n  }\n\n}\n\nexport class LoginEffects {\n  constructor( //private sources: EffectSources,\n  actions$, router, callAPIComponent, apiAddresses) {\n    this.actions$ = actions$;\n    this.router = router;\n    this.callAPIComponent = callAPIComponent;\n    this.apiAddresses = apiAddresses;\n    this.login = this.actions$.pipe(ofType(LoginActions.LOGIN_START), switchMap(data => {\n      console.log('effect');\n      console.log(data);\n      return this.callAPIComponent.PostApi(this.apiAddresses.GetServiceUrl(ApiUrlPostfix.CmsLogin), new LoginRequestClass(data.payload.userName, data.payload.password)).pipe(map(resData => {\n        localStorage.setItem('userData', JSON.stringify(resData));\n        return new LoginActions.LoginSuccess(resData);\n      }), catchError(errorRes => {\n        return of(new LoginActions.LoginFail(errorRes.error));\n      }));\n    }));\n    this.authRedirect = this.actions$.pipe(ofType(LoginActions.Login_SUCCESS), tap(() => {\n      this.router.navigate(['/AdminPanel']);\n    }));\n    this.autoLogin = this.actions$.pipe(ofType(LoginActions.AUTO_LOGIN), map(() => {\n      const user = JSON.parse(localStorage.getItem('userData'));\n\n      if (!user) {\n        return {\n          type: 'عدم دسترسی'\n        };\n      }\n\n      return new LoginActions.LoginSuccess(user);\n    }));\n    this.logout = this.actions$.pipe(ofType(LoginActions.LOGOUT), tap(() => {\n      new LoginActions.Logout();\n      localStorage.removeItem('userData');\n      this.router.navigate(['']);\n    })); // sources.addEffects(this);\n\n    console.log('effect inject');\n  }\n\n}\n\nLoginEffects.ɵfac = function LoginEffects_Factory(t) {\n  return new (t || LoginEffects)(i0.ɵɵinject(i1.Actions), i0.ɵɵinject(i2.Router), i0.ɵɵinject(i3.CallAPIComponent), i0.ɵɵinject(i4.ApiAddresses));\n};\n\nLoginEffects.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: LoginEffects,\n  factory: LoginEffects.ɵfac\n});\n\n__decorate([Effect()], LoginEffects.prototype, \"login\", void 0);\n\n__decorate([Effect({\n  dispatch: false\n})], LoginEffects.prototype, \"authRedirect\", void 0);\n\n__decorate([Effect()], LoginEffects.prototype, \"autoLogin\", void 0);\n\n__decorate([Effect()], LoginEffects.prototype, \"logout\", void 0);","map":null,"metadata":{},"sourceType":"module"}